!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.uploader=t():e.uploader=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist",t(t.s=0)}({"./node_modules/lodash.assign/index.js":function(e,t){function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function r(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function i(e,t){return function(n){return e(t(n))}}function s(e,t){var n=N(e)||v(e)?r(e.length,String):[],i=n.length,s=!!i;for(var a in e)!t&&!D.call(e,a)||s&&("length"==a||l(a,i))||n.push(a);return n}function a(e,t,n){var r=e[t];D.call(e,t)&&d(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function u(e){if(!p(e))return j(e);var t=[];for(var n in Object(e))D.call(e,n)&&"constructor"!=n&&t.push(n);return t}function o(e,t){return t=F(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=F(r.length-t,0),a=Array(s);++i<s;)a[i]=r[t+i];i=-1;for(var u=Array(t+1);++i<t;)u[i]=r[i];return u[t]=a,n(e,this,u)}}function c(e,t,n,r){n||(n={});for(var i=-1,s=t.length;++i<s;){var u=t[i],o=r?r(n[u],e[u],u,n,e):void 0;a(n,u,void 0===o?e[u]:o)}return n}function f(e){return o(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,a&&h(n[0],n[1],a)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var u=n[r];u&&e(t,u,r,s)}return t})}function l(e,t){return!!(t=null==t?w:t)&&("number"==typeof e||S.test(e))&&e>-1&&e%1==0&&e<t}function h(e,t,n){if(!b(n))return!1;var r=typeof t;return!!("number"==r?m(n)&&l(t,n.length):"string"==r&&t in n)&&d(n[t],e)}function p(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||O)}function d(e,t){return e===t||e!==e&&t!==t}function v(e){return g(e)&&D.call(e,"callee")&&(!P.call(e,"callee")||L.call(e)==R)}function m(e){return null!=e&&k(e.length)&&!y(e)}function g(e){return x(e)&&m(e)}function y(e){var t=b(e)?L.call(e):"";return t==T||t==_}function k(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=w}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function x(e){return!!e&&"object"==typeof e}function E(e){return m(e)?s(e):u(e)}var w=9007199254740991,R="[object Arguments]",T="[object Function]",_="[object GeneratorFunction]",S=/^(?:0|[1-9]\d*)$/,O=Object.prototype,D=O.hasOwnProperty,L=O.toString,P=O.propertyIsEnumerable,j=i(Object.keys,Object),F=Math.max,I=!P.call({valueOf:1},"valueOf"),N=Array.isArray,U=f(function(e,t){if(I||p(t)||m(t))return void c(t,E(t),e);for(var n in t)D.call(t,n)&&a(e,n,t[n])});e.exports=U},"./node_modules/process/browser.js":function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(l===clearTimeout)return clearTimeout(e);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function a(){v&&p&&(v=!1,p.length?d=p.concat(d):m=-1,d.length&&u())}function u(){if(!v){var e=i(a);v=!0;for(var t=d.length;t;){for(p=d,d=[];++m<t;)p&&p[m].run();m=-1,t=d.length}p=null,v=!1,s(e)}}function o(e,t){this.fun=e,this.array=t}function c(){}var f,l,h=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(e){l=r}}();var p,d=[],v=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new o(e,t)),1!==d.length||v||i(u)},o.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=c,h.addListener=c,h.once=c,h.off=c,h.removeListener=c,h.removeAllListeners=c,h.emit=c,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},"./src/eventBus.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}n.d(t,"a",function(){return o});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return u(e,[{key:"getListeners",value:function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t}},{key:"flattenListeners",value:function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n}},{key:"getListenersAsObject",value:function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n}},{key:"addListener",value:function(e,t){var n,r=this.getListenersAsObject(e),s="object"===(void 0===t?"undefined":a(t));for(n in r)r.hasOwnProperty(n)&&i(r[n],t)===-1&&r[n].push(s?t:{listener:t,once:!1});return this}},{key:"on",value:function(){return s("addListener").apply(this,arguments)}},{key:"addOnceListener",value:function(e,t){return this.addListener(e,{listener:t,once:!0})}},{key:"once",value:function(){return s("addOnceListener").apply(this,arguments)}},{key:"defineEvent",value:function(e){return this.getListeners(e),this}},{key:"defineEvents",value:function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this}},{key:"removeListener",value:function(e,t){var n,r,s=this.getListenersAsObject(e);for(r in s)s.hasOwnProperty(r)&&(n=i(s[r],t))!==-1&&s[r].splice(n,1);return this}},{key:"off",value:function(){return s("removeListener").apply(this,arguments)}},{key:"addListeners",value:function(e,t){return this.manipulateListeners(!1,e,t)}},{key:"removeListeners",value:function(e,t){return this.manipulateListeners(!0,e,t)}},{key:"manipulateListeners",value:function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,u=e?this.removeListeners:this.addListeners;if("object"!==(void 0===t?"undefined":a(t))||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):u.call(this,r,i));return this}},{key:"removeEvent",value:function(e){var t,n=void 0===e?"undefined":a(e),r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this}},{key:"emitEvent",value:function(e,t){var n,r,i,s,a,u=this.getListenersAsObject(e),o=[];for(s in u)if(u.hasOwnProperty(s))for(n=u[s].slice(0),i=n.length;i--;)r=n[i],r.once===!0&&this.removeListener(e,r.listener),a=r.listener.apply(this,t||[]),a===this._getOnceReturnValue()&&this.removeListener(e,r.listener),o.push(a);return Promise.all(o)}},{key:"emit",value:function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)}},{key:"setOnceReturnValue",value:function(e){return this._onceReturnValue=e,this}},{key:"_getOnceReturnValue",value:function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:1}},{key:"_getEvents",value:function(){return this._events||(this._events={})}},{key:"removeEvents",value:function(){this._events={}}}]),e}()},"./src/file.js":function(e,t,n){"use strict";function r(){return s+a++}function i(e,t){this.eventEmitter=t.eventEmitter;var n=Object.keys(e);for(var s in n)this[n[s]]=e[n[s]];this.id=r(),this.name=e.name||t.setName(this.id)||"Untitled";var a=u.exec(e.name)?RegExp.$1.toLowerCase():"";this.ext=a,!this.ext&&e.type&&(a=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(e.type)?RegExp.$1.toLowerCase():"")&&(this.name+="."+a),this.path=e.path||"Untitled",this.isFile=!0,this.size=e.size||0,this.type=e.type||"application/octet-stream",this.lastModifiedDate=e.lastModifiedDate||1*new Date,this.statusText="inited",o[this.id]=i.Status.INITED,this.source=e,this.loaded=0}t.a=i;var s="WU_FILE_",a=0,u=/\.([^.]+)$/,o={};i.prototype={constructor:i,setStatus:function(e,t){var n=o[this.id];void 0!==t&&(this.statusText=t),e!==n&&(o[this.id]=e,this.eventEmitter.trigger("statuschange",e,n))},getStatus:function(){return o[this.id]},getSource:function(){return this.source},destroy:function(){delete o[this.id]}},i.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"}},"./src/index.js":function(e,t,n){"use strict";(function(e){function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(i,s){try{var a=t[i](s),u=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=n("./src/eventBus.js"),a=n("./src/transport.js"),u=n("./src/file.js");n.d(t,"Uploader",function(){return f}),n.d(t,"UploaderStatus",function(){return l}),n.d(t,"FileStatus",function(){return h});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c={timeout:0,accept:null,auto:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,formData:{},headers:{},fileVal:"file",method:"POST",fileNumLimit:void 0,fileSizeLimit:void 0,fileSingleSizeLimit:void 0,dnd:void 0,pick:void 0,paste:void 0,server:"",linterContiner:document,$:null,body:document.body,multiple:!1,setName:function(e){return""+(new Date).getTime()+e}},f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i(this,t),this.filesQueue=[],this._selectFileTransactionId=0,this.config=Object.assign({},c,e),this.status=t.Status.INITED,null===this.config.$||void 0===this.config.$)throw new Error("$ 必须定义");if(this.$=this.config.$,this.inputId="fileUploadBtn-"+(new Date).getTime(),this.eventEmitter=new s.a,this.$.isPlainObject(this.config.accept)&&(this.config.accept=[this.config.accept]),this.config.accept){for(var n=[],r=0,a=this.config.accept.length;r<a;r++){var u=this.config.accept[r].extensions;u&&n.push(u)}n.length&&(this.accept="\\."+n.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),this.accept=new RegExp(this.accept,"i")}this._pickOnChangeBindThis=this._pickOnChange.bind(this),this._pickOnClickBindThis=this._pickOnClick.bind(this),this._dndHandleDragenterBindThis=this._dndHandleDragenter.bind(this),this._dndHandleDragoverBindThis=this._dndHandleDragover.bind(this),this._dndHandleDragleaveBindThis=this._dndHandleDragleave.bind(this),this._dndHandleDropBindThis=this._dndHandleDrop.bind(this),this.init()}return o(t,[{key:"acceptFile",value:function(e){return!(!e||!e.size||this.accept&&/\.\w+$/.exec(e.name)&&!this.accept.test(e.name))}},{key:"init",value:function(){var e='<input type="file" id="'+this.inputId+'" size="30" name="fileselect[]" style="position:absolute;top:-100000px;">',t=this.$(e);if(this.config.accept&&this.config.accept.length>0){for(var n=[],r=0,i=this.config.accept.length;r<i;r++)n.push(this.config.accept[r].mimeTypes);t.attr("accept",n.join(","))}this.config.multiple&&t.attr("multiple","multiple"),this.$("#"+this.inputId).remove(),this.$(this.config.body).append(t),this.reset(),this.config.pick&&this._pickHandle(),this.config.dnd&&this._dndHandle(),this.config.paste&&this._pasteHandle()}},{key:"_resetinput",value:function(e){e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()}},{key:"reset",value:function(){this._resetinput(this.$("#"+this.inputId))}},{key:"_pasteHandle",value:function(){var e=this;this.config.paste&&this.$(this.config.linterContiner).on("paste",this.config.paste,function(t){var n=t.clipboardData||t.originalEvent.clipboardData;if(n)for(var r=n.items,i=0;i<r.length;++i){var s=r[i],a=null;"file"===s.kind&&(a=s.getAsFile())&&(t.stopPropagation(),t.preventDefault(),e._selectFileTransactionId++,e.pushQueue(a))}})}},{key:"_pickHandle",value:function(){this.$(document).on("change","#"+this.inputId,this._pickOnChangeBindThis),this.config.pick&&this.$(document).on("click",this.config.pick,this._pickOnClickBindThis)}},{key:"_pickOnChange",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),t.preventDefault(),e.next=4,this.funGetFiles(t);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"_pickOnClick",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),t.preventDefault(),this.$("#"+this.inputId).click();case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"_dndHandle",value:function(){this.config.dnd&&(this.$(this.config.linterContiner).on("dragenter",this.config.dnd,this._dndHandleDragenterBindThis),this.$(this.config.linterContiner).on("dragover",this.config.dnd,this._dndHandleDragoverBindThis),this.$(this.config.linterContiner).on("dragleave",this.config.dnd,this._dndHandleDragleaveBindThis),this.$(this.config.linterContiner).on("drop",this.config.dnd,this._dndHandleDropBindThis))}},{key:"_dndHandleDragenter",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),t.preventDefault();case 2:case"end":return e.stop()}},e,this)}));return e}()},{key:"_dndHandleDragover",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.originalEvent.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault(),this.eventEmitter.emit("dragover");case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"_dndHandleDragleave",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.stopPropagation(),t.preventDefault(),this.eventEmitter.emit("dragleave");case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"_dndHandleDrop",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),t.preventDefault(),e.next=4,this.funGetFiles(t.originalEvent);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"funGetFiles",value:function(){function t(e){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function t(n){var r,i,s,a,u,o,c,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this._selectFileTransactionId++,r=n.target.files||n.dataTransfer.files,i=n.target.items||n.dataTransfer&&n.dataTransfer.items,s=[];for(a in i)i[a]&&i.hasOwnProperty(a)&&(i[a].getAsEntry?s.push(i[a].getAsEntry()):i[a].webkitGetAsEntry?s.push(i[a].webkitGetAsEntry()):s.push({}));return t.next=7,this.eventEmitter.emit("beforeFilesQueued",r);case 7:u=0,o=Object.keys(r).length;case 8:if(!(u<o)){t.next=29;break}if(!(c=r[u])){t.next=26;break}if(!s||!s[u]){t.next=17;break}if(null===(f=s[u])||!f.isDirectory){t.next=17;break}return t.next=16,this.folderRead(f);case 16:return t.abrupt("continue",26);case 17:if("pc-nw"==e.env.APP_ENV?Object.defineProperty(c,"path",{value:"/"+c.name}):c.path="/"+c.name,!this.config.multiple){t.next=23;break}return t.next=21,this.pushQueue(c);case 21:t.next=26;break;case 23:return t.next=25,this.pushQueue(c);case 25:return t.abrupt("break",29);case 26:u++,t.next=8;break;case 29:return t.next=31,this.eventEmitter.emit("filesQueued");case 31:case"end":return t.stop()}},t,this)}));return t}()},{key:"folderRead",value:function(){function t(e){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function t(n){var i,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.path=n.fullPath,n.selectFileTransactionId=this._selectFileTransactionId,t.next=4,this.eventEmitter.emit("selectDir",n);case 4:if(i=t.sent,i.indexOf(!1)!==-1){t.next=8;break}return t.next=8,new Promise(function(t){n.createReader().readEntries(function(){var i=r(regeneratorRuntime.mark(function i(a){var u,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:u=regeneratorRuntime.mark(function t(){var i,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=a[o],!i.isFile){t.next=13;break}return t.next=4,new Promise(function(t){i.file(function(){var n=r(regeneratorRuntime.mark(function n(r){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:"pc-nw"==e.env.APP_ENV?Object.defineProperty(r,"path",{value:i.fullPath}):r.path=i.fullPath,t(r);case 2:case"end":return n.stop()}},n,s)}));return function(e){return n.apply(this,arguments)}}())});case 4:return u=t.sent,t.next=7,s.eventEmitter.emit("beforeChildFileQueued",u,n);case 7:return t.next=9,s.pushQueue(u,n);case 9:return t.next=11,s.eventEmitter.emit("childFileQueued",u);case 11:t.next=20;break;case 13:if(!i.isDirectory){t.next=20;break}return t.next=16,s.eventEmitter.emit("beforeChildDirQueued",i,n);case 16:return t.next=18,s.folderRead(i,n);case 18:return t.next=20,s.eventEmitter.emit("childDirQueued",i);case 20:case"end":return t.stop()}},t,s)}),o=0;case 2:if(!(o<a.length)){i.next=7;break}return i.delegateYield(u(),"t0",4);case 4:o++,i.next=2;break;case 7:t();case 8:case"end":return i.stop()}},i,s)}));return function(e){return i.apply(this,arguments)}}())});case 8:case"end":return t.stop()}},t,this)}));return t}()},{key:"fileFilter",value:function(e){return isNaN(Number(this.config.fileNumLimit)),isNaN(Number(this.config.fileSingleSizeLimit)),this.acceptFile(e)?e:(this.eventEmitter.emit("uploadError",e,"不支持的文件格式"),!1)}},{key:"pushQueue",value:function(){function e(e){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.selectFileTransactionId=this._selectFileTransactionId,!(n=this.fileFilter(n))){e.next=13;break}return r=new u.a(n,{eventEmitter:this.eventEmitter,setName:this.config.setName}),e.next=6,this.eventEmitter.emit("beforeFileQueued",r);case 6:if(i=e.sent,i.indexOf(!1)!==-1){e.next=13;break}return r.statusText=u.a.Status.QUEUED,this.filesQueue.push(r),e.next=12,this.eventEmitter.emit("fileQueued",r);case 12:this.config.auto&&this.status!==t.Status.UPLOADING&&this.startUpload();case 13:case"end":return e.stop()}},e,this)}));return e}()},{key:"_pushUploaderFile",value:function(){function e(e){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n instanceof u.a||(n=new u.a(n,{eventEmitter:this.eventEmitter,setName:this.config.setName})),n.selectFileTransactionId=++this._selectFileTransactionId,!(n=this.fileFilter(n))){e.next=9;break}return n.statusText=u.a.Status.QUEUED,this.filesQueue.push(n),e.next=8,this.eventEmitter.emit("fileQueued",n);case 8:this.config.auto&&this.status!==t.Status.UPLOADING&&this.startUpload();case 9:case"end":return e.stop()}},e,this)}));return e}()},{key:"on",value:function(e,t){this.eventEmitter.on(e,t)}},{key:"removeEvent",value:function(e){this.eventEmitter.removeEvent(e)}},{key:"startUpload",value:function(){function e(){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status===t.Status.UPLOADING){e.next=17;break}case 1:if(!(this.filesQueue.filter(function(e){return e.statusText===u.a.Status.QUEUED}).length>0)){e.next=13;break}if(this.status=t.Status.UPLOADING,n=this.filesQueue.filter(function(e){return e.statusText===u.a.Status.QUEUED})[0],!n.isFile){e.next=9;break}return e.next=7,this.startHandleFile(n);case 7:e.next=11;break;case 9:return e.next=11,this.startHandleDir(n);case 11:e.next=1;break;case 13:if(0!==this.filesQueue.filter(function(e){return e.statusText===u.a.Status.QUEUED}).length){e.next=17;break}return e.next=16,this.eventEmitter.emit("filesQueuedEmpty");case 16:this.status=t.Status.INITED;case 17:case"end":return e.stop()}},e,this)}));return e}()},{key:"startHandleDir",value:function(){function e(){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}));return e}()},{key:"startHandleFile",value:function(){function e(e){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(n){var r,i,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=1,i=0,n.statusText=u.a.Status.PROGRESS,this.eventEmitter.on("uploadBeforeSend",function(e){r=e.currentShard}),this.eventEmitter.on("uploadBlobProgress",function(e,t){i<e+s.config.chunkSize*(r-1)&&(i=e+s.config.chunkSize*(r-1),s.eventEmitter.emit("uploadProgress",n,i,e,t))}),e.prev=5,e.next=8,this._upfile(n);case 8:return e.next=10,this.eventEmitter.emit("uploadComplete",n);case 10:this.eventEmitter.removeEvent("uploadBlobProgress"),e.next=20;break;case 13:return e.prev=13,e.t0=e.catch(5),this.file.statusText=u.a.Status.ERROR,this.status=t.Status.FILEERROR,e.next=19,this.eventEmitter.emit("uploadError",n,e.t0);case 19:throw e.t0;case 20:return e.prev=20,this.file={},e.finish(20);case 23:case"end":return e.stop()}},e,this,[[5,13,20,23]])}));return e}()},{key:"_upfile",value:function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){var n,r,i,s,a,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.file=t,e.next=3,this.eventEmitter.emit("uploadStart",t);case 3:if(!this.config.chunked){e.next=42;break}n=Math.ceil(t.size/this.config.chunkSize),0===n&&(n=1),r=0;case 7:if(!(r<n)){e.next=40;break}if(t.statusText!==u.a.Status.PROGRESS){e.next=36;break}return i=r*this.config.chunkSize,s=Math.min(t.size,i+this.config.chunkSize),a=t.source.slice(i,s),e.next=13,this.eventEmitter.emit("uploadBeforeSend",{file:t,shard:a,shardCount:n,currentShard:r+1});case 13:if(""!==this.config.server.trim()){e.next=15;break}throw new Error("server could not be empty");case 15:return e.prev=15,e.next=18,this._baseupload(a,t.name);case 18:if(o=e.sent,n!==r+1){e.next=24;break}return this.file.statusText=u.a.Status.COMPLETE,e.next=23,this.eventEmitter.emit("uploadSuccess",t);case 23:this._removeFileFromQueue(t.id);case 24:return e.next=26,this.eventEmitter.emit("uploadAccept",{file:t,shard:a,shardCount:n,currentShard:r+1},o);case 26:e.next=32;break;case 28:return e.prev=28,e.t0=e.catch(15),e.next=32,this._catchUpfileError(e.t0,t);case 32:return e.next=34,this.eventEmitter.emit("uploadEndSend",{file:t,shard:a,shardCount:n,currentShard:r+1});case 34:e.next=37;break;case 36:return e.abrupt("break",40);case 37:r++,e.next=7;break;case 40:e.next=62;break;case 42:return e.next=44,this.eventEmitter.emit("uploadBeforeSend",{file:t});case 44:return e.prev=44,e.next=47,this._baseupload(t.source,t.name);case 47:return c=e.sent,e.next=50,this.eventEmitter.emit("uploadAccept",{file:t},c);case 50:return t.statusText=u.a.Status.COMPLETE,e.next=53,this.eventEmitter.emit("uploadSuccess",t);case 53:this._removeFileFromQueue(t.id),e.next=60;break;case 56:return e.prev=56,e.t1=e.catch(44),e.next=60,this._catchUpfileError(e.t1,t);case 60:return e.next=62,this.eventEmitter.emit("uploadEndSend",{file:t});case 62:return e.next=64,this.eventEmitter.emit("fileUploadEnd",t);case 64:case"end":return e.stop()}},e,this,[[15,28],[44,56]])}));return e}()},{key:"_catchUpfileError",value:function(){function e(e,t){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.file.statusText===u.a.Status.INTERRUPT||this.file.statusText===u.a.Status.CANCELLED){e.next=5;break}return this.file.statusText=u.a.Status.ERROR,this.status=t.Status.FILEERROR,e.next=5,this.eventEmitter.emit("uploadError",r,n);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"destory",value:function(){this.eventEmitter.removeEvents(),this.filesQueue=[],this.transport&&this.transport.abort(),this.config.dnd&&(this.$(document).off("dragover",this._dndHandleDragover),this.$(document).off("dragleave",this._dndHandleDragleave),this.$(document).off("drop",this._dndHandleDrop)),this.$(document).off("change",this._pickOnChangeBindThis),this.config.pick&&this.$(document).off("click",this._pickOnClickBindThis)}},{key:"_removeFileFromQueue",value:function(e){this.filesQueue=this.filesQueue.filter(function(t){return t.id!==e})}},{key:"removeFile",value:function(e){this._removeFileFromQueue(e),this.file&&this.file.id===e&&(this.file.statusText=u.a.Status.CANCELLED,this.transport&&this.transport.abort())}},{key:"interruptFile",value:function(e){this.file&&this.file.id===e&&(this.file.statusText=u.a.Status.INTERRUPT,this.transport&&this.transport.abort())}},{key:"interruptAllFile",value:function(e){var t=this;this.filesQueue.forEach(function(n){t.file&&t.file.id===n.id&&e[n.id]?t.interruptFile(n.id):e[n.id]&&(n.statusText=u.a.Status.CANCELLED)})}},{key:"resetFile",value:function(){function e(e){return n.apply(this,arguments)}var n=r(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.file&&this.file.id!==n&&this.filesQueue.forEach(function(e){e.id===n&&(e.statusText=u.a.Status.QUEUED)}),this.status===t.Status.UPLOADING){e.next=4;break}return e.next=4,this.startUpload();case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"_baseupload",value:function(){function e(e,n){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t,n){var r,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r={server:this.config.server,method:this.config.method,fileVal:this.config.fileVal,timeout:this.config.timeout,formData:this.config.formData,headers:this.config.headers,fileName:n},i=null,s=0;case 3:if(!(s<this.config.chunkRetry)){e.next=23;break}if(this.file.statusText!==u.a.Status.PROGRESS){e.next=19;break}return e.prev=5,this.transport=new a.a(t,this.eventEmitter,r),e.next=9,this.transport.send();case 9:return i=e.sent,e.abrupt("break",23);case 13:throw e.prev=13,e.t0=e.catch(5),console.error(e.t0),new Error("已取消");case 17:e.next=20;break;case 19:throw new Error("已取消");case 20:s++,e.next=3;break;case 23:return this.transport=null,e.abrupt("return",i);case 25:case"end":return e.stop()}},e,this,[[5,13]])}));return e}()}]),t}(),l=f.Status={INITED:"inited",FILEERROR:"fileError",UPLOADING:"UPLOADING"},h=u.a.Status}).call(t,n("./node_modules/process/browser.js"))},"./src/transport.js":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n("./node_modules/lodash.assign/index.js"),s=n.n(i);n.d(t,"a",function(){return c});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o={server:"",method:"POST",fileVal:"file",timeout:12e4,formData:{},headers:{},fileName:void 0},c=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,e),!t)throw new Error("blob should not empty");this.eventEmitter=n,this.config=s()({},o,i),this._blob=t}return u(e,[{key:"append",value:function(e,t){"object"===(void 0===e?"undefined":a(e))?s()(this.config.formData,e):this.config.formData[e]=t}},{key:"setRequestHeader",value:function(e,t){"object"===(void 0===e?"undefined":a(e))?s()(this._headers,e):this.config.headers[e]=t}},{key:"abort",value:function(){this.xhr.abort()}},{key:"send",value:function(){var e=this;return new Promise(function(t,n){var r=new XMLHttpRequest;e.xhr=r;var i=new FormData;r.upload.addEventListener("progress",function(t){e.eventEmitter.emit("uploadBlobProgress",t.loaded,t.total)},!1),0!==e.config.timeout&&(r.timeout=e.config.timeout),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<=300?(e.eventEmitter.emit("_uploadSuccess",e._blob,r.responseText),t(r.responseText)):(e.eventEmitter.emit("_uploadError",r.statusText),n(r.statusText)))},r.ontimeout=function(e){eventEmitter.emit("timeout",e)},Object.keys(e.config.formData).forEach(function(t){i.append(t,e.config.formData[t])}),i.append(e.config.fileVal,e._blob,e.config.fileName),r.open(e.config.method,e.config.server,!0),Object.keys(e.config.headers).forEach(function(t){r.setRequestHeader(t,e.config.headers[t])}),r.send(i)})}}]),e}()},0:function(e,t,n){e.exports=n("./src/index.js")}})});